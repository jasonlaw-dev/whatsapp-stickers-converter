(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t,a){e.exports=a(203)},112:function(e,t,a){},120:function(e,t){},122:function(e,t){},203:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(52),s=a.n(i),o=(a(112),a(23)),c=a(24),l=a(37),u=a(34),p=a(38),m=a(106),d=a.n(m),h=a(14),f=a.n(h),b=a(13),g=a.n(b),v=a(54),w=a.n(v),y=a(98),k=a(10),_=a.n(k),E=a(15),x=a(5),C=a.n(x),F=a(36),I=a.n(F),S=a(104),A=a.n(S),j=a(103),z=a.n(j),M=a(35),T=a.n(M),L=a(102),O=a.n(L),P=a(101),W=a.n(P),D=a(99),N=a.n(D),U=a(55),R=a(53),B=a.n(R),G=a(100),q=a.n(G),V=a(28),H=a.n(V),J=function(){function e(){Object(o.a)(this,e),this.module=null,this.api=null}return Object(c.a)(e,[{key:"init",value:function(){var e=this;if(!function(){try{if("object"===typeof WebAssembly&&"function"===typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(t){return!1}return!1}())throw new Error("WebAssembly is not supported.");return new Promise(function(t,a){setTimeout(function(){return a(new Error("WebAssembly is not loaded."))},2e3),libwebp().then(function(a){e.module=a,e.api={version:a.cwrap("version","number",[]),create_buffer:a.cwrap("create_buffer","number",["number","number"]),create_buffer_with_size:a.cwrap("create_buffer_with_size","number",["number"]),destroy_buffer:a.cwrap("destroy_buffer","",["number"]),encode:a.cwrap("encode","",["number","number","number","number"]),decode:a.cwrap("decode","number",["number","number"]),free_result:a.cwrap("free_result","",["number"]),get_encode_result_pointer:a.cwrap("get_encode_result_pointer","number",[]),get_encode_result_size:a.cwrap("get_encode_result_size","number",[]),get_decode_result_pointer:a.cwrap("get_decode_result_pointer","number",[]),get_decode_result_width:a.cwrap("get_decode_result_width","number",[]),get_decode_result_height:a.cwrap("get_decode_result_height","number",[])},console.log("WebAssembly libwebp loaded, api version: ".concat(e.api.version())),t()})})}},{key:"unzip",value:function(){var e=Object(E.a)(_.a.mark(function e(t){return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",q.a.loadAsync(t).then(function(){var e=Object(E.a)(_.a.mark(function e(t){var a;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],t.forEach(function(e){e.startsWith("__MACOSX")||!e.endsWith(".png")&&!e.endsWith(".jpg")||a.push(e)}),!(a.length<3)){e.next=4;break}throw new Error("Less than 3 images are found!");case 4:return e.next=6,t.file(a[0]).async("blob");case 6:return e.t0=e.sent,e.next=9,Promise.all(a.map(function(e){return t.file(e).async("blob")}));case 9:return e.t1=e.sent,e.abrupt("return",{trayFile:e.t0,stickersFiles:e.t1});case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"processImageFile",value:function(){var e=Object(E.a)(_.a.mark(function e(t,a){var n=this;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){var i=new FileReader;i.onloadend=Object(E.a)(_.a.mark(function t(){return _.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"tray"!==a){t.next=9;break}return t.t0=e,t.next=5,n.resizeAndConvert(i.result,96,!1);case 5:t.t1=t.sent,(0,t.t0)(t.t1),t.next=15;break;case 9:if("stickers"!==a){t.next=15;break}return t.t2=e,t.next=13,n.resizeAndConvert(i.result,512,!0);case 13:t.t3=t.sent,(0,t.t2)(t.t3);case 15:t.next=20;break;case 17:t.prev=17,t.t4=t.catch(0),r(t.t4);case 20:case"end":return t.stop()}},t,this,[[0,17]])})),i.readAsArrayBuffer(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"convertImageDataToWebpURL",value:function(e,t){var a=this.api.create_buffer(e.width,e.height);this.module.HEAP8.set(e.data,a),this.api.encode(a,e.width,e.height,t);var n=this.api.get_encode_result_pointer(),r=this.api.get_encode_result_size(),i=new Uint8Array(this.module.HEAP8.buffer,n,r),s=new Uint8Array(i);return this.api.free_result(n),this.api.destroy_buffer(a),"data:image/webp;base64,".concat(btoa(s.reduce(function(e,t){return e+String.fromCharCode(t)},"")))}},{key:"convertWebpURLToPngURL",value:function(e){for(var t=atob(e.replace(/^data:image\/[a-z]+;base64,/,"")),a=t.length,n=new Uint8Array(a),r=0;r<a;r++)n[r]=t.charCodeAt(r);var i=this.api.create_buffer_with_size(n.byteLength);this.module.HEAP8.set(n,i),this.api.decode(i,a);var s=this.api.get_decode_result_pointer(),o=this.api.get_decode_result_width(),c=this.api.get_decode_result_height(),l=o*c*4,u=new Uint8Array(this.module.HEAP8.buffer,s,l),p=new Uint8ClampedArray(u);this.api.free_result(s),this.api.destroy_buffer(i);var m=document.createElement("canvas"),d=m.getContext("2d"),h=new ImageData(p,o,c);return m.width=o,m.height=c,d.putImageData(h,0,0),m.toDataURL("image/png")}},{key:"resizeAndConvert",value:function(t,a,n){var r=this;return B.a.read(t).then(function(t){var i=t.contain(a,a).getBase64Async(B.a.MIME_PNG);return n?i.then(function(){var t=Object(E.a)(_.a.mark(function t(a){var n,i,s,o,c,l,u,p;return _.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dataURLToCanvasContext(a);case 2:n=t.sent,i=n.canvas,s=n.getImageData(0,0,i.width,i.height),o=1,c=!1;case 7:if(l=c?i.toDataURL("image/webp",o):r.convertImageDataToWebpURL(s,Math.ceil(100*o)),!((u=atob(l.replace(/^data:image\/[a-z]+;base64,/,"")).length)<=1e5)){t.next=12;break}return t.abrupt("break",19);case 12:if(o-=.08,p="WebP size ".concat(Math.ceil(u/1024),"kb exceeded 100kb"),!(o<=.07)){t.next=16;break}throw new Error("Error converting files, ".concat(p));case 16:console.error("".concat(p,", resizing with quality ").concat(o)),t.next=7;break;case 19:return t.abrupt("return",l);case 20:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()):i})}},{key:"convertImagesToPacks",value:function(t,a){var n=this,r=new H.a;return Object(E.a)(_.a.mark(function i(){var s,o,c,l,u,p,m;return _.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,n.processImageFile(t,"tray");case 3:for(s=i.sent,o=[],c=Math.ceil(a.length/30),l=0;l<c;l++)o.push([]);return i.next=9,Promise.all(o.map(function(t,a){return 1===c?Promise.resolve(s):e.addNumberToTray(s,"".concat(a+1))}));case 9:u=i.sent,p=0;case 11:if(!(p<a.length)){i.next=20;break}return i.next=14,n.processImageFile(a[p],"stickers");case 14:m=i.sent,r.emit("stickerLoad"),o[Math.floor(p/30)].push(m);case 17:p++,i.next=11;break;case 20:c>1&&o[c-1].length<3&&(o[c-1]=Object(U.a)(o[c-2].splice(-(3-o[c-1].length))).concat(Object(U.a)(o[c-1]))),r.emit("load",{trays:u,stickersInPack:o}),i.next=27;break;case 24:i.prev=24,i.t0=i.catch(0),r.emit("error",i.t0);case 27:case"end":return i.stop()}},i,this,[[0,24]])}))(),r}}],[{key:"dataURLToCanvasContext",value:function(e){return new Promise(function(t){var a=document.createElement("canvas"),n=a.getContext("2d"),r=new Image;r.addEventListener("load",function(){a.width=r.width,a.height=r.height,n.drawImage(r,0,0,a.width,a.height),t(n)},!1),r.src=e})}},{key:"addNumberToTray",value:function(){var t=Object(E.a)(_.a.mark(function t(a,n){var r,i;return _.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dataURLToCanvasContext(a);case 2:return r=t.sent,i=r.canvas,r.save(),r.beginPath(),r.arc(i.width-0-16,i.height-0-16,16,0,2*Math.PI),r.fillStyle="rgba(53, 67, 90, 0.85)",r.fill(),r.restore(),r.font="30px helvetica",r.textAlign="center",r.fillStyle="#f7f7f7",r.lineWidth=2,r.fillText("".concat(n),i.width-0-16,i.height-0-6),t.abrupt("return",i.toDataURL("image/png"));case 16:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()}]),e}(),Z=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).converter=null,a.handleSubmit=function(e){e.preventDefault(),a.setState({progress:0,errorMsg:"",isSubmitting:!0,convertedPacks:[]});var t=a.state,n=t.identifier,r=t.name,i=t.publisher,s=t.zipFile,o=t.uploadType;Object(E.a)(_.a.mark(function e(){var t,c,l,u,p,m,d,h,f,b,g;return _.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,c=t.trayFile,l=t.stickersFiles,"image"===o)for(l=[],u=0;u<a.state.stickersFiles.length;u++)l.push(a.state.stickersFiles[u]);if("zip"!==o){e.next=8;break}return e.next=5,a.converter.unzip(s);case 5:p=e.sent,c=p.trayFile,l=p.stickersFiles;case 8:return m=a.converter.convertImagesToPacks(c,l),d=0,m.on("stickerLoad",function(){d+=1,a.setState({progress:d/l.length*100})}),e.next=13,new Promise(function(e,t){m.on("error",t),m.on("load",e)});case 13:h=e.sent,f=h.trays,b=h.stickersInPack,g=b.map(function(e,t){return{identifier:n+(0===t?"":"_".concat(t+1)),name:r+(0===t?"":" (".concat(t+1,")")),publisher:i,tray_image:f[t].replace(/^data:image\/[a-z]+;base64,/,""),stickers:e.map(function(e){return{image_data:e.replace(/^data:image\/[a-z]+;base64,/,"")}})}}),console.log(g),g.forEach(function(e){a.props.isMobile||(1===g.length||a.props.isDownloadMultipleFilesSupported)&&a.handleDownload(e)}),a.setState({convertedPacks:g,isSubmitting:!1}),window.scrollTo(0,document.body.scrollHeight),gtag("event","stickers-convert",{packs:g.length,stickers:l.length});case 22:case"end":return e.stop()}},e,this)}))().catch(function(t){console.error(t),a.setState({errorMsg:t.message||e.toString(),isSubmitting:!1})})},a.handleFileChange=function(e,t){e.preventDefault(),"tray"===t?a.setState({trayFile:e.target.files[0]}):"stickers"===t?a.setState({stickersFiles:e.target.files}):"zip"===t&&a.setState({zipFile:e.target.files[0]})},a.handleInputChange=function(e){a.setState(Object(y.a)({},e.target.id,e.target.value))},a.handleDownload=function(e){var t=JSON.stringify(e);if(a.props.isMobile){var n="twesticker://json?data=".concat(encodeURIComponent(t));window.open(n)}else N()(new Blob([t],{type:"application/json"}),"".concat(e.identifier,".json"))},a.isFormValid=function(){return a.isIdentifierValid()&&a.state.identifier&&a.state.name&&a.state.publisher&&("image"===a.state.uploadType&&null!=a.state.trayFile&&a.state.stickersFiles&&a.state.stickersFiles.length>=3||"zip"===a.state.uploadType&&null!=a.state.zipFile)},a.isSubmittable=function(){return a.isFormValid()&&!a.state.isSubmitting},a.isIdentifierValid=function(){return/^[A-Za-z0-9-_.\s]*$/.test(a.state.identifier)},a.state={identifier:"",name:"",publisher:"",trayFile:null,stickersFiles:null,zipFile:null,isSubmitting:!1,progress:0,errorMsg:"",convertedPacks:[],uploadType:"image",isApiLoaded:!0},a.converter=new J,a.converter.init().then().catch(function(e){console.error(e),a.setState({isApiLoaded:!1})}),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(C.a,{onSubmit:function(t){return e.handleSubmit(t)}},this.state.isApiLoaded||r.a.createElement(W.a,{variant:"danger"},"Critical API not loaded, please refresh."),r.a.createElement(C.a.Group,{as:f.a,controlId:"identifier"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Identifier"),r.a.createElement(g.a,{sm:6},r.a.createElement(C.a.Control,{type:"text",required:!0,onChange:this.handleInputChange,isInvalid:!this.isIdentifierValid()}),r.a.createElement(C.a.Control.Feedback,{type:"invalid"},'Alphanumeric characters with ".", "_", "-" or " " only '))),r.a.createElement(C.a.Group,{as:f.a,controlId:"name"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Pack Name"),r.a.createElement(g.a,{sm:6},r.a.createElement(C.a.Control,{type:"text",required:!0,onChange:this.handleInputChange}))),r.a.createElement(C.a.Group,{as:f.a,controlId:"publisher"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Publisher"),r.a.createElement(g.a,{sm:6},r.a.createElement(C.a.Control,{type:"text",required:!0,onChange:this.handleInputChange}))),r.a.createElement(C.a.Group,{as:f.a,controlId:"uploadType"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Upload Type"),r.a.createElement(g.a,{sm:8},r.a.createElement(O.a,null,r.a.createElement(z.a,{type:"radio",name:"options",value:this.state.uploadType,onChange:function(t){return e.handleInputChange({target:{id:"uploadType",value:t}})}},r.a.createElement(T.a,{value:"image"},"Image Files"),r.a.createElement(T.a,{value:"zip"},"Zip File"))))),"image"===this.state.uploadType?r.a.createElement("div",null,r.a.createElement(C.a.Group,{as:f.a,controlId:"formTrayFile"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Tray Icon"),r.a.createElement(g.a,{sm:8},r.a.createElement("div",{className:"custom-file"},r.a.createElement(C.a.Control,{className:"custom-file-input",type:"file",required:!0,isValid:!1,onChange:function(t){return e.handleFileChange(t,"tray")},accept:"image/png, image/jpeg"}),r.a.createElement(C.a.Label,{className:"custom-file-label"},this.state.trayFile?this.state.trayFile.name:"Choose file (any resolution)")))),r.a.createElement(C.a.Group,{as:f.a,controlId:"formStickersFiles"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Stickers (3 or more images)"),r.a.createElement(g.a,{sm:8},r.a.createElement("div",{className:"custom-file"},r.a.createElement(C.a.Control,{className:"custom-file-input",type:"file",required:!0,multiple:!0,onChange:function(t){return e.handleFileChange(t,"stickers")},accept:"image/png"}),r.a.createElement(C.a.Label,{className:"custom-file-label"},this.state.stickersFiles&&this.state.stickersFiles.length>0?"".concat(this.state.stickersFiles.length," file(s) selected"):"Choose file (any resolution)"))))):"zip"===this.state.uploadType?r.a.createElement(C.a.Group,{as:f.a,controlId:"formZipFile"},r.a.createElement(C.a.Label,{column:!0,sm:4},"Zip file"),r.a.createElement(g.a,{sm:8},r.a.createElement("div",{className:"custom-file"},r.a.createElement(C.a.Control,{className:"custom-file-input",type:"file",required:!0,multiple:!0,onChange:function(t){return e.handleFileChange(t,"zip")},accept:".zip"}),r.a.createElement(C.a.Label,{className:"custom-file-label"},this.state.zipFile?this.state.zipFile.name:"Choose file")))):null,r.a.createElement(I.a,{type:"submit",disabled:!this.isSubmittable()},"Convert Images"),r.a.createElement(A.a,{style:{transition:"none",marginTop:"15px"},now:this.state.progress,hidden:!this.state.isSubmitting&&!this.state.errorMsg,variant:this.state.errorMsg?"danger":""}),r.a.createElement("p",{className:this.state.errorMsg?"text-danger":"text-success",hidden:!this.state.errorMsg&&100!==this.state.progress},this.state.errorMsg||"Images converted!"),(this.props.isMobile||this.state.convertedPacks.length>1&&!this.props.isDownloadMultipleFilesSupported)&&this.state.convertedPacks.map(function(t,a){return r.a.createElement("div",{style:{marginTop:"3px",marginBottom:"3px"}},r.a.createElement(I.a,{variant:"outline-primary",onClick:function(){return e.handleDownload(t)}},"JSON File ".concat(a+1)))}))}}]),t}(r.a.Component),$=a(105),X=a.n($),K=(a(196),function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).isMobile=!1,a.isDownloadMultipleFilesSupported=!1;var n=new X.a(window.navigator),r=n.getOS(),i=n.getBrowser(),s=r&&r.name?r.name:"",c=i&&i.name?i.name:"";return a.isMobile=s.startsWith("Android")||s.startsWith("iOS"),a.isDownloadMultipleFilesSupported=c.startsWith("Chrom"),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(d.a,{style:{marginTop:"20px",marginBottom:"20px"}},r.a.createElement(f.a,{className:"justify-content-md-center"},r.a.createElement(g.a,{lg:10},r.a.createElement(w.a,{bg:"light",expand:"lg",style:{marginBottom:"20px"}},r.a.createElement(w.a.Brand,null,"WhatsApp Stickers Converter")))),r.a.createElement(f.a,{className:"justify-content-md-center"},r.a.createElement(g.a,{lg:10},r.a.createElement(Z,{isMobile:this.isMobile,isDownloadMultipleFilesSupported:this.isDownloadMultipleFilesSupported}))))}}]),t}(r.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(K,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[107,2,1]]]);
//# sourceMappingURL=main.7ffae1d6.chunk.js.map